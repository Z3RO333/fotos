<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rio de Visita T√©cnica</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(ellipse at 20% 80%, rgba(18, 40, 75, 0.6) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(41, 14, 58, 0.6) 0%, transparent 50%),
                radial-gradient(ellipse at 40% 40%, rgba(15, 32, 90, 0.4) 0%, transparent 50%);
            animation: nebulaPulse 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes nebulaPulse {
            0%, 100% {
                opacity: 0.8;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.1);
            }
        }

        /* Poeira c√≥smica */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(2px 2px at 20% 30%, rgba(255, 255, 255, 0.05), transparent),
                radial-gradient(2px 2px at 60% 70%, rgba(255, 255, 255, 0.05), transparent),
                radial-gradient(1px 1px at 50% 50%, rgba(255, 255, 255, 0.03), transparent),
                radial-gradient(1px 1px at 80% 10%, rgba(255, 255, 255, 0.04), transparent),
                radial-gradient(2px 2px at 90% 60%, rgba(255, 255, 255, 0.05), transparent);
            background-size: 200% 200%, 180% 180%, 150% 150%, 220% 220%, 190% 190%;
            background-position: 0% 0%, 100% 0%, 50% 50%, 0% 100%, 100% 100%;
            animation: cosmicDustFloat 60s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes cosmicDustFloat {
            0%, 100% {
                background-position: 0% 0%, 100% 0%, 50% 50%, 0% 100%, 100% 100%;
            }
            50% {
                background-position: 100% 100%, 0% 100%, 25% 75%, 100% 0%, 0% 0%;
            }
        }

        /* Fundo animado com part√≠culas */
        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        /* Campo de estrelas - Camada 1 (estrelas pequenas) */
        .background-animation::before {
            content: '';
            position: absolute;
            width: 1px;
            height: 1px;
            background: white;
            box-shadow:
                100px 200px white, 300px 100px white, 500px 350px white,
                700px 150px white, 200px 450px white, 850px 250px white,
                400px 500px white, 150px 300px white, 650px 400px white,
                800px 50px white, 50px 150px white, 250px 250px white,
                450px 150px white, 600px 300px white, 350px 400px white,
                550px 200px white, 750px 450px white, 900px 350px white,
                50px 500px white, 200px 100px white, 400px 300px white,
                600px 150px white, 800px 400px white, 100px 350px white,
                300px 500px white, 500px 100px white, 700px 300px white,
                900px 200px white, 150px 450px white, 350px 150px white,
                550px 350px white, 750px 100px white, 250px 400px white,
                450px 250px white, 650px 500px white, 850px 150px white,
                950px 450px white, 50px 250px white, 150px 100px white,
                350px 300px white, 550px 450px white, 750px 200px white,
                250px 500px white, 450px 350px white, 650px 100px white,
                850px 300px white, 1050px 250px white, 1150px 400px white,
                1250px 150px white, 1350px 350px white, 1450px 200px white,
                125px 275px white, 425px 425px white, 575px 125px white,
                825px 475px white, 275px 175px white, 975px 275px white,
                1100px 325px white, 1300px 225px white, 1400px 450px white,
                75px 375px white, 325px 75px white, 625px 225px white,
                875px 375px white, 225px 525px white, 525px 275px white;
            animation: starTwinkle 4s infinite ease-in-out;
        }

        @keyframes starTwinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.2; }
        }

        /* Gal√°xia espiral distante */
        .background-animation::after {
            content: '';
            position: absolute;
            top: 5%;
            right: 10%;
            width: 500px;
            height: 500px;
            background:
                radial-gradient(ellipse at center,
                    rgba(120, 150, 255, 0.4) 0%,
                    rgba(100, 130, 220, 0.25) 20%,
                    rgba(80, 110, 200, 0.15) 40%,
                    transparent 70%);
            border-radius: 50%;
            animation: galaxyRotate 80s linear infinite, galaxyPulse 10s ease-in-out infinite;
            filter: blur(60px);
        }

        @keyframes galaxyRotate {
            0% { transform: rotate(0deg) scale(1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        @keyframes galaxyPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 0.9; }
        }

        /* Estrelas maiores brilhantes */
        .bright-star {
            position: absolute;
            width: 3px;
            height: 3px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(150, 200, 255, 0.8),
                        0 0 10px rgba(255, 255, 255, 0.6);
            animation: brightTwinkle 6s infinite ease-in-out;
        }

        @keyframes brightTwinkle {
            0%, 100% {
                opacity: 0.7;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.5);
            }
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(150, 180, 255, 0.4), rgba(80, 120, 200, 0.2));
            backdrop-filter: blur(5px);
            animation: float 15s infinite ease-in-out;
            box-shadow: 0 0 60px rgba(100, 150, 255, 0.4),
                        inset -10px -10px 30px rgba(50, 80, 150, 0.3);
        }

        /* Varia√ß√µes de cores para diferentes part√≠culas (planetas) */
        .particle:nth-child(1),
        .particle:nth-child(5),
        .particle:nth-child(9) {
            background: radial-gradient(circle at 30% 30%, rgba(100, 150, 255, 0.5), rgba(50, 100, 200, 0.2));
            box-shadow: 0 0 60px rgba(70, 120, 255, 0.5),
                        inset -10px -10px 30px rgba(30, 60, 150, 0.4);
        }

        .particle:nth-child(3),
        .particle:nth-child(7),
        .particle:nth-child(11) {
            background: radial-gradient(circle at 30% 30%, rgba(180, 120, 255, 0.4), rgba(120, 80, 200, 0.2));
            box-shadow: 0 0 50px rgba(150, 100, 255, 0.4),
                        inset -10px -10px 30px rgba(80, 50, 150, 0.3);
        }

        .particle:nth-child(2),
        .particle:nth-child(6),
        .particle:nth-child(10) {
            background: radial-gradient(circle at 30% 30%, rgba(120, 200, 255, 0.4), rgba(80, 150, 220, 0.2));
            box-shadow: 0 0 70px rgba(90, 170, 255, 0.5),
                        inset -10px -10px 30px rgba(50, 100, 180, 0.3);
        }

        .particle:nth-child(1) {
            width: 80px;
            height: 80px;
            left: 10%;
            top: 20%;
            animation-duration: 12s;
            animation-delay: 0s;
        }

        .particle:nth-child(2) {
            width: 60px;
            height: 60px;
            left: 80%;
            top: 10%;
            animation-duration: 14s;
            animation-delay: 2s;
        }

        .particle:nth-child(3) {
            width: 100px;
            height: 100px;
            left: 50%;
            top: 60%;
            animation-duration: 16s;
            animation-delay: 4s;
        }

        .particle:nth-child(4) {
            width: 40px;
            height: 40px;
            left: 20%;
            top: 80%;
            animation-duration: 10s;
            animation-delay: 1s;
        }

        .particle:nth-child(5) {
            width: 70px;
            height: 70px;
            left: 70%;
            top: 70%;
            animation-duration: 13s;
            animation-delay: 3s;
        }

        .particle:nth-child(6) {
            width: 50px;
            height: 50px;
            left: 40%;
            top: 30%;
            animation-duration: 11s;
            animation-delay: 5s;
        }

        .particle:nth-child(7) {
            width: 90px;
            height: 90px;
            left: 85%;
            top: 50%;
            animation-duration: 15s;
            animation-delay: 2.5s;
        }

        .particle:nth-child(8) {
            width: 45px;
            height: 45px;
            left: 5%;
            top: 50%;
            animation-duration: 12.5s;
            animation-delay: 4.5s;
        }

        .particle:nth-child(9) {
            width: 65px;
            height: 65px;
            left: 60%;
            top: 15%;
            animation-duration: 14.5s;
            animation-delay: 1.5s;
        }

        .particle:nth-child(10) {
            width: 55px;
            height: 55px;
            left: 30%;
            top: 90%;
            animation-duration: 13.5s;
            animation-delay: 3.5s;
        }

        .particle:nth-child(11) {
            width: 75px;
            height: 75px;
            left: 90%;
            top: 85%;
            animation-duration: 16.5s;
            animation-delay: 0.5s;
        }

        .particle:nth-child(12) {
            width: 35px;
            height: 35px;
            left: 15%;
            top: 40%;
            animation-duration: 11.5s;
            animation-delay: 5.5s;
        }

        @keyframes float {
            0%, 100% {
                transform: translate(0, 0) scale(1) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            50% {
                transform: translate(50px, -70px) scale(1.4) rotate(180deg);
                opacity: 0.8;
            }
            90% {
                opacity: 1;
            }
        }

        /* Brilho nas part√≠culas (planetas) */
        .particle::before {
            content: '';
            position: absolute;
            width: 60%;
            height: 60%;
            top: 10%;
            left: 10%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, transparent 70%);
            border-radius: 50%;
            animation: shimmerPlanet 4s infinite ease-in-out;
        }

        @keyframes shimmerPlanet {
            0%, 100% {
                opacity: 0.3;
                transform: translate(0, 0);
            }
            50% {
                opacity: 0.6;
                transform: translate(5px, 5px);
            }
        }

        /* Estrelas cadentes ocasionais */
        .particle:nth-child(4)::after,
        .particle:nth-child(8)::after {
            content: '';
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            top: -20px;
            right: -20px;
            animation: shootingStar 5s ease-in infinite;
        }

        @keyframes shootingStar {
            0% {
                transform: translateX(0) translateY(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            100% {
                transform: translateX(-300px) translateY(300px);
                opacity: 0;
            }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5),
                        0 0 0 1px rgba(26, 47, 77, 0.2),
                        0 0 40px rgba(26, 47, 77, 0.15);
            overflow: hidden;
            animation: fadeIn 0.8s ease;
            position: relative;
            z-index: 1;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .header {
            background: linear-gradient(135deg, #1a2f4d 0%, #0d1b2a 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header-logo {
            position: absolute;
            top: 20px;
            right: 30px;
            width: 60px;
            height: 60px;
            z-index: 2;
            opacity: 0.9;
            transition: all 0.3s ease;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        .header-logo:hover {
            opacity: 1;
            transform: scale(1.15) rotate(5deg);
            filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.5));
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: shimmer 8s infinite linear;
        }

        @keyframes shimmer {
            0% {
                transform: translate(-50%, -50%) rotate(0deg);
            }
            100% {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            padding-right: 80px;
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 22px;
                padding-right: 70px;
            }

            .header-logo {
                width: 45px;
                height: 45px;
                right: 15px;
                top: 15px;
            }
        }

        .header p {
            position: relative;
            z-index: 1;
        }

        .form-content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
            animation: fadeInUp 0.6s ease;
        }

        .section:last-child {
            border-bottom: none;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-size: 20px;
            color: #1a2f4d;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #1a2f4d;
            position: relative;
            display: inline-block;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, #1a2f4d, #2a4365);
            animation: expandLine 1.2s ease forwards;
            animation-delay: 0.3s;
        }

        @keyframes expandLine {
            to {
                width: 100%;
            }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        label.required::after {
            content: " *";
            color: #dc3545;
        }

        input[type="text"],
        input[type="email"],
        input[type="date"],
        input[type="time"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #1a2f4d;
            box-shadow: 0 0 0 3px rgba(26, 47, 77, 0.1);
            transform: translateY(-1px);
        }

        input:hover,
        select:hover,
        textarea:hover {
            border-color: #2a4365;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            background: #e9ecef;
            border-color: #1a2f4d;
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(26, 47, 77, 0.15);
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
            accent-color: #1a2f4d;
        }

        .checkbox-item label {
            margin: 0;
            cursor: pointer;
            font-weight: 500;
        }

        /* Estilos para categorias com upload */
        .categoria-item {
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.4s ease;
            background: white;
        }

        .categoria-item:hover {
            border-color: #1a2f4d;
            box-shadow: 0 4px 12px rgba(26, 47, 77, 0.15);
            transform: translateY(-2px);
        }

        .categoria-header {
            display: flex;
            align-items: center;
            padding: 16px;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .categoria-header:hover {
            background: #e9ecef;
        }

        .categoria-header input[type="checkbox"] {
            width: 22px;
            height: 22px;
            margin-right: 12px;
            cursor: pointer;
            accent-color: #1a2f4d;
        }

        .categoria-header label {
            margin: 0;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            flex: 1;
        }

        .categoria-content {
            padding: 15px;
            background: white;
            border-top: 2px solid #e0e0e0;
            animation: expandDown 0.3s ease;
            overflow: hidden;
        }

        @keyframes expandDown {
            from {
                opacity: 0;
                max-height: 0;
                padding: 0 15px;
            }
            to {
                opacity: 1;
                max-height: 1000px;
                padding: 15px;
            }
        }

        .categoria-content textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 14px;
            resize: vertical;
            transition: all 0.3s ease;
            background: white;
        }

        .categoria-content textarea:focus {
            border-color: #1a2f4d;
            box-shadow: 0 0 0 3px rgba(26, 47, 77, 0.1);
            transform: translateY(-1px);
        }

        .categoria-content textarea:hover {
            border-color: #2a4365;
        }

        .mini-upload-area {
            border: 2px dashed #1a2f4d;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            background: #f0f4f8;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .mini-upload-area:hover {
            background: #e2e8f0;
            border-color: #0d1b2a;
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(26, 47, 77, 0.2);
        }

        .upload-label {
            color: #1a2f4d;
            font-weight: 600;
        }

        .foto-preview-mini {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .foto-preview-mini .foto-item {
            position: relative;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .foto-preview-mini .foto-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-color: #1a2f4d;
        }

        .foto-preview-mini .foto-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }

        .foto-preview-mini .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 26px;
            height: 26px;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(220, 53, 69, 0.3);
        }

        .foto-preview-mini .remove-btn:hover {
            background: #c82333;
            transform: scale(1.15) rotate(90deg);
            box-shadow: 0 3px 10px rgba(220, 53, 69, 0.5);
        }

        .file-upload-area {
            border: 3px dashed #1a2f4d;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: #f0f4f8;
            cursor: pointer;
            transition: all 0.4s ease;
        }

        .file-upload-area:hover {
            background: #e2e8f0;
            border-color: #0d1b2a;
            transform: scale(1.01);
            box-shadow: 0 8px 20px rgba(26, 47, 77, 0.2);
        }

        .file-upload-area input[type="file"] {
            display: none;
        }

        .foto-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .foto-preview-item {
            position: relative;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            background: white;
            transition: all 0.3s ease;
        }

        .foto-preview-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            border-color: #1a2f4d;
        }

        .foto-preview-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .foto-preview-item .foto-info {
            padding: 10px;
            background: #f8f9fa;
        }

        .foto-preview-item .foto-info input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .foto-preview-item .foto-info input:focus {
            border-color: #1a2f4d;
            outline: none;
            box-shadow: 0 0 0 2px rgba(26, 47, 77, 0.1);
        }

        .foto-preview-item .foto-info input:hover {
            border-color: #2a4365;
        }

        .foto-preview-item .remove-foto {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);
        }

        .foto-preview-item .remove-foto:hover {
            background: #c82333;
            transform: scale(1.15) rotate(90deg);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.5);
        }

        .status-selector {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .status-option {
            flex: 1;
            padding: 15px;
            border: 3px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            background: white;
        }

        .status-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .status-option input[type="radio"] {
            display: none;
        }

        .status-option.ok {
            border-color: #28a745;
        }

        .status-option.ok:hover {
            background: #e8f5e9;
        }

        .status-option.atencao {
            border-color: #ffc107;
        }

        .status-option.atencao:hover {
            background: #fff8e1;
        }

        .status-option.critico {
            border-color: #dc3545;
        }

        .status-option.critico:hover {
            background: #ffebee;
        }

        .status-option input:checked + label {
            font-weight: bold;
        }

        .status-option.ok input[type="radio"]:checked ~ label {
            color: #155724;
        }

        .status-option.ok input[type="radio"]:checked {
            & ~ * {
                transition: all 0.4s ease;
            }
        }

        .status-option.ok:has(input[type="radio"]:checked) {
            background: #d4edda;
            border-width: 4px;
            box-shadow: 0 5px 20px rgba(40, 167, 69, 0.3);
        }

        .status-option.atencao input[type="radio"]:checked ~ label {
            color: #856404;
        }

        .status-option.atencao:has(input[type="radio"]:checked) {
            background: #fff3cd;
            border-width: 4px;
            box-shadow: 0 5px 20px rgba(255, 193, 7, 0.3);
        }

        .status-option.critico input[type="radio"]:checked ~ label {
            color: #721c24;
        }

        .status-option.critico:has(input[type="radio"]:checked) {
            background: #f8d7da;
            border-width: 4px;
            box-shadow: 0 5px 20px rgba(220, 53, 69, 0.3);
        }

        .btn-submit {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #1a2f4d 0%, #0d1b2a 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 4px 15px rgba(26, 47, 77, 0.5);
        }

        .btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(26, 47, 77, 0.7);
            background: linear-gradient(135deg, #2a4365 0%, #1a2f4d 100%);
        }

        .btn-submit:active {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(26, 47, 77, 0.6);
        }

        .btn-submit:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1a2f4d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 16px 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            display: none;
            animation: slideDown 0.4s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            font-weight: 500;
        }

        .alert.show {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
            border-left: 5px solid #28a745;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
            border-left: 5px solid #dc3545;
        }
    </style>
</head>
<body>
    <!-- Fundo animado gal√°xia -->
    <div class="background-animation">
        <!-- Planetas/Esferas flutuantes -->
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <!-- Via L√°ctea -->
    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; overflow: hidden;">
        <div style="position: absolute; top: 30%; left: -10%; width: 120%; height: 40%; background: linear-gradient(90deg, transparent 0%, rgba(100, 130, 200, 0.1) 20%, rgba(120, 150, 220, 0.15) 50%, rgba(100, 130, 200, 0.1) 80%, transparent 100%); transform: rotate(-15deg); filter: blur(80px); animation: milkyWayDrift 40s ease-in-out infinite;"></div>

        <!-- Estrelas brilhantes maiores -->
        <div class="bright-star" style="top: 15%; left: 20%; animation-delay: 0s;"></div>
        <div class="bright-star" style="top: 25%; left: 65%; animation-delay: 1s;"></div>
        <div class="bright-star" style="top: 40%; left: 85%; animation-delay: 2s;"></div>
        <div class="bright-star" style="top: 60%; left: 30%; animation-delay: 0.5s;"></div>
        <div class="bright-star" style="top: 70%; left: 75%; animation-delay: 1.5s;"></div>
        <div class="bright-star" style="top: 80%; left: 15%; animation-delay: 2.5s;"></div>
        <div class="bright-star" style="top: 10%; left: 50%; animation-delay: 3s;"></div>
        <div class="bright-star" style="top: 35%; left: 10%; animation-delay: 3.5s;"></div>
        <div class="bright-star" style="top: 55%; left: 55%; animation-delay: 4s;"></div>
        <div class="bright-star" style="top: 85%; left: 90%; animation-delay: 4.5s;"></div>

        <!-- Nebulosas coloridas -->
        <div style="position: absolute; bottom: 10%; left: 5%; width: 350px; height: 350px; background: radial-gradient(circle, rgba(80, 120, 255, 0.2) 0%, rgba(50, 80, 180, 0.1) 40%, transparent 70%); border-radius: 50%; filter: blur(70px); animation: nebulaDrift1 35s ease-in-out infinite;"></div>
        <div style="position: absolute; top: 20%; right: 25%; width: 280px; height: 280px; background: radial-gradient(circle, rgba(150, 100, 255, 0.15) 0%, rgba(100, 60, 180, 0.08) 40%, transparent 70%); border-radius: 50%; filter: blur(60px); animation: nebulaDrift2 40s ease-in-out infinite;"></div>
        <div style="position: absolute; bottom: 30%; right: 10%; width: 300px; height: 300px; background: radial-gradient(circle, rgba(100, 180, 255, 0.18) 0%, rgba(60, 120, 200, 0.09) 40%, transparent 70%); border-radius: 50%; filter: blur(65px); animation: nebulaDrift3 45s ease-in-out infinite;"></div>
    </div>

    <style>
        @keyframes milkyWayDrift {
            0%, 100% { transform: rotate(-15deg) translateX(0); opacity: 0.6; }
            50% { transform: rotate(-15deg) translateX(50px); opacity: 0.8; }
        }
        @keyframes nebulaDrift1 {
            0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.6; }
            50% { transform: translate(30px, -30px) scale(1.1); opacity: 0.8; }
        }
        @keyframes nebulaDrift2 {
            0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.5; }
            50% { transform: translate(-40px, 20px) scale(1.15); opacity: 0.7; }
        }
        @keyframes nebulaDrift3 {
            0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.55; }
            50% { transform: translate(20px, 40px) scale(1.08); opacity: 0.75; }
        }
    </style>

    <div class="container">
        <div class="header">
            <svg class="header-logo" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" aria-label="√çcone capacete">
                <defs>
                    <style>
                        .helmet-fill { fill: #1d56c2; }
                    </style>
                </defs>
                <!-- Capacete estilizado (baseado no √≠cone enviado) -->
                <path class="helmet-fill" d="M22 55c0-21 17-38 38-38s38 17 38 38v10H22Z"/>
                <rect class="helmet-fill" x="18" y="55" width="84" height="10" rx="4"/>
                <rect class="helmet-fill" x="52" y="10" width="16" height="22" rx="4"/>
                <path class="helmet-fill" fill-rule="evenodd" d="M24 70a36 36 0 0 0 72 0H24Zm12 0a24 24 0 0 0 48 0H36Z"/>
                <rect class="helmet-fill" x="28" y="42" width="12" height="10" rx="3"/>
                <rect class="helmet-fill" x="80" y="42" width="12" height="10" rx="3"/>
            </svg>

            <h1>üìã Relat√≥rio de Visita T√©cnica</h1>
            <p>Preencha todos os campos obrigat√≥rios (*)</p>
        </div>

        <div class="form-content">
            <div id="alertContainer"></div>

            <form id="formVisita">
                <!-- SE√á√ÉO 1: DADOS DA UNIDADE -->
                <div class="section">
                    <h2 class="section-title">üè¢ Informa√ß√µes da Unidade</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="codigoLoja" class="required">C√≥digo da Loja</label>
                            <input type="text" id="codigoLoja" name="codigoLoja" 
                                   placeholder="Ex: LJ-089" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="nomeLoja" class="required">Nome da Unidade</label>
                            <input type="text" id="nomeLoja" name="nomeLoja" 
                                   placeholder="Ex: Bemol Manaus Centro" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cidade" class="required">Cidade</label>
                            <input type="text" id="cidade" name="cidade" 
                                   placeholder="Ex: Manaus" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="tipoUnidade" class="required">Tipo de Unidade</label>
                            <select id="tipoUnidade" name="tipoUnidade" required>
                                <option value="">Selecione...</option>
                                <option value="Loja">Loja</option>
                                <option value="CD">Centro de Distribui√ß√£o</option>
                                <option value="Farmacia">Farm√°cia</option>
                                <option value="Matriz">Matriz</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- SE√á√ÉO 2: DADOS DA VISITA -->
                <div class="section">
                    <h2 class="section-title">üë§ Dados da Visita</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nomeVisitante" class="required">Nome do Visitante</label>
                            <input type="text" id="nomeVisitante" name="nomeVisitante" 
                                   placeholder="Seu nome completo" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="emailVisitante" class="required">E-mail</label>
                            <input type="email" id="emailVisitante" name="emailVisitante" 
                                   placeholder="seu.email@empresa.com" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="area" class="required">√Årea</label>
                            <select id="area" name="area" required>
                                <option value="">Selecione...</option>
                                <option value="Facilities">Facilities</option>
                                <option value="Manuten√ß√£o">Manuten√ß√£o</option>
                                <option value="TI">TI</option>
                                <option value="Seguran√ßa">Seguran√ßa</option>
                                <option value="Qualidade">Qualidade</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="tipoVisita" class="required">Tipo de Visita</label>
                            <select id="tipoVisita" name="tipoVisita" required>
                                <option value="">Selecione...</option>
                                <option value="Inspe√ß√£o Mensal">Inspe√ß√£o Mensal</option>
                                <option value="Checklist">Checklist</option>
                                <option value="P√≥s-Obra">P√≥s-Obra</option>
                                <option value="Auditoria">Auditoria</option>
                                <option value="Emerg√™ncia">Emerg√™ncia</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="dataVisita" class="required">Data da Visita</label>
                            <input type="date" id="dataVisita" name="dataVisita" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="horaVisita" class="required">Hora da Visita</label>
                            <input type="time" id="horaVisita" name="horaVisita" required>
                        </div>
                    </div>
                </div>

                <!-- SE√á√ÉO 3: AVALIA√á√ÉO -->
                <div class="section">
                    <h2 class="section-title">üìä Avalia√ß√£o Geral</h2>
                    
                    <div class="form-group">
                        <label class="required">Status Geral da Unidade</label>
                        <div class="status-selector">
                            <div class="status-option ok">
                                <input type="radio" id="statusOk" name="statusGeral" value="OK" required>
                                <label for="statusOk">
                                    <div style="font-size: 30px; margin-bottom: 5px;">‚úì</div>
                                    <div>OK</div>
                                </label>
                            </div>
                            
                            <div class="status-option atencao">
                                <input type="radio" id="statusAtencao" name="statusGeral" value="Aten√ß√£o">
                                <label for="statusAtencao">
                                    <div style="font-size: 30px; margin-bottom: 5px;">‚ö†</div>
                                    <div>Aten√ß√£o</div>
                                </label>
                            </div>
                            
                            <div class="status-option critico">
                                <input type="radio" id="statusCritico" name="statusGeral" value="Cr√≠tico">
                                <label for="statusCritico">
                                    <div style="font-size: 30px; margin-bottom: 5px;">‚úï</div>
                                    <div>Cr√≠tico</div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Pontos Avaliados (selecione e anexe fotos)</label>

                        <!-- Sistema El√©trico -->
                        <div class="categoria-item">
                            <div class="categoria-header">
                                <input type="checkbox" id="ponto1" name="pontosAvaliados" value="Sistema El√©trico">
                                <label for="ponto1">‚ö° Sistema El√©trico</label>
                            </div>
                            <div class="categoria-content" id="content-ponto1" style="display: none;">
                                <textarea placeholder="Observa√ß√µes sobre Sistema El√©trico..." id="obs-ponto1" rows="2"></textarea>
                                <div class="mini-upload-area" data-categoria="ponto1">
                                    <input type="file" id="foto-ponto1" accept="image/*" multiple style="display: none;">
                                    <div class="upload-label">üì∑ Clique para adicionar fotos</div>
                                </div>
                                <div class="foto-preview-mini" id="preview-ponto1"></div>
                            </div>
                        </div>

                        <!-- Climatiza√ß√£o -->
                        <div class="categoria-item">
                            <div class="categoria-header">
                                <input type="checkbox" id="ponto2" name="pontosAvaliados" value="Climatiza√ß√£o">
                                <label for="ponto2">‚ùÑÔ∏è Climatiza√ß√£o</label>
                            </div>
                            <div class="categoria-content" id="content-ponto2" style="display: none;">
                                <textarea placeholder="Observa√ß√µes sobre Climatiza√ß√£o..." id="obs-ponto2" rows="2"></textarea>
                                <div class="mini-upload-area" data-categoria="ponto2">
                                    <input type="file" id="foto-ponto2" accept="image/*" multiple style="display: none;">
                                    <div class="upload-label">üì∑ Clique para adicionar fotos</div>
                                </div>
                                <div class="foto-preview-mini" id="preview-ponto2"></div>
                            </div>
                        </div>

                        <!-- Limpeza Geral -->
                        <div class="categoria-item">
                            <div class="categoria-header">
                                <input type="checkbox" id="ponto3" name="pontosAvaliados" value="Limpeza Geral">
                                <label for="ponto3">üßπ Limpeza Geral</label>
                            </div>
                            <div class="categoria-content" id="content-ponto3" style="display: none;">
                                <textarea placeholder="Observa√ß√µes sobre Limpeza..." id="obs-ponto3" rows="2"></textarea>
                                <div class="mini-upload-area" data-categoria="ponto3">
                                    <input type="file" id="foto-ponto3" accept="image/*" multiple style="display: none;">
                                    <div class="upload-label">üì∑ Clique para adicionar fotos</div>
                                </div>
                                <div class="foto-preview-mini" id="preview-ponto3"></div>
                            </div>
                        </div>

                        <!-- Layout e Sinaliza√ß√£o -->
                        <div class="categoria-item">
                            <div class="categoria-header">
                                <input type="checkbox" id="ponto4" name="pontosAvaliados" value="Layout e Sinaliza√ß√£o">
                                <label for="ponto4">üèóÔ∏è Layout e Sinaliza√ß√£o</label>
                            </div>
                            <div class="categoria-content" id="content-ponto4" style="display: none;">
                                <textarea placeholder="Observa√ß√µes sobre Layout e Sinaliza√ß√£o..." id="obs-ponto4" rows="2"></textarea>
                                <div class="mini-upload-area" data-categoria="ponto4">
                                    <input type="file" id="foto-ponto4" accept="image/*" multiple style="display: none;">
                                    <div class="upload-label">üì∑ Clique para adicionar fotos</div>
                                </div>
                                <div class="foto-preview-mini" id="preview-ponto4"></div>
                            </div>
                        </div>

                        <!-- Equipamentos TI -->
                        <div class="categoria-item">
                            <div class="categoria-header">
                                <input type="checkbox" id="ponto5" name="pontosAvaliados" value="Equipamentos TI">
                                <label for="ponto5">üíª Equipamentos TI</label>
                            </div>
                            <div class="categoria-content" id="content-ponto5" style="display: none;">
                                <textarea placeholder="Observa√ß√µes sobre Equipamentos TI..." id="obs-ponto5" rows="2"></textarea>
                                <div class="mini-upload-area" data-categoria="ponto5">
                                    <input type="file" id="foto-ponto5" accept="image/*" multiple style="display: none;">
                                    <div class="upload-label">üì∑ Clique para adicionar fotos</div>
                                </div>
                                <div class="foto-preview-mini" id="preview-ponto5"></div>
                            </div>
                        </div>

                        <!-- Seguran√ßa -->
                        <div class="categoria-item">
                            <div class="categoria-header">
                                <input type="checkbox" id="ponto6" name="pontosAvaliados" value="Seguran√ßa">
                                <label for="ponto6">üõ°Ô∏è Seguran√ßa</label>
                            </div>
                            <div class="categoria-content" id="content-ponto6" style="display: none;">
                                <textarea placeholder="Observa√ß√µes sobre Seguran√ßa..." id="obs-ponto6" rows="2"></textarea>
                                <div class="mini-upload-area" data-categoria="ponto6">
                                    <input type="file" id="foto-ponto6" accept="image/*" multiple style="display: none;">
                                    <div class="upload-label">üì∑ Clique para adicionar fotos</div>
                                </div>
                                <div class="foto-preview-mini" id="preview-ponto6"></div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="observacoes">Observa√ß√µes Gerais</label>
                        <textarea id="observacoes" name="observacoes" 
                                  placeholder="Descreva detalhes da visita, pontos de aten√ß√£o, etc."></textarea>
                    </div>
                </div>

                <!-- SE√á√ÉO 4: A√á√ïES -->
                <div class="section">
                    <h2 class="section-title">‚ö° A√ß√µes Necess√°rias</h2>
                    
                    <div class="form-group">
                        <label for="acoesNecessarias">Descreva as A√ß√µes</label>
                        <textarea id="acoesNecessarias" name="acoesNecessarias" 
                                  placeholder="Liste as a√ß√µes que precisam ser tomadas..."></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="prazo">Prazo Recomendado</label>
                            <input type="text" id="prazo" name="prazo" 
                                   placeholder="Ex: 15 dias">
                        </div>
                        
                        <div class="form-group">
                            <label for="prioridade">Prioridade</label>
                            <select id="prioridade" name="prioridade">
                                <option value="Baixa">Baixa</option>
                                <option value="M√©dia" selected>M√©dia</option>
                                <option value="Alta">Alta</option>
                                <option value="Cr√≠tica">Cr√≠tica</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- SE√á√ÉO 5: FOTOS GERAIS (OPCIONAL) -->
                <div class="section">
                    <h2 class="section-title">üì∏ Fotos Gerais (Opcional)</h2>
                    <p style="color: #6c757d; margin-bottom: 15px;">Use esta se√ß√£o para fotos adicionais que n√£o se encaixam nas categorias acima.</p>

                    <div class="file-upload-area" id="fileUploadArea">
                        <input type="file" id="fotosInput" accept="image/*" multiple>
                        <div style="font-size: 50px; margin-bottom: 15px;">üì∑</div>
                        <h3>Clique ou arraste fotos aqui</h3>
                        <p style="color: #6c757d; margin-top: 10px;">Aceita JPG, PNG (m√°x 30 fotos)</p>
                    </div>

                    <div class="foto-preview-container" id="fotoPreviewContainer"></div>
                </div>

                <!-- BOT√ÉO ENVIAR -->
                <button type="submit" class="btn-submit" id="btnSubmit">
                    üì§ Enviar Relat√≥rio
                </button>

                <div class="loading" id="loadingDiv">
                    <div class="spinner"></div>
                    <p>Processando seu relat√≥rio... Por favor, aguarde.</p>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ========== CONFIGURA√á√ÉO ==========
        const CONFIG = {
            
            //   Webhook
            webhookUrl: 'https://bemol.app.n8n.cloud/webhook/visita', 
            
    
            
            maxFotos: 30,
            maxTamanhoFoto: 5 * 1024 * 1024 // 5MB
        };

        // ========== VARI√ÅVEIS GLOBAIS ==========
        let fotosArray = [];
        let fotosPorCategoria = {
            ponto1: [],
            ponto2: [],
            ponto3: [],
            ponto4: [],
            ponto5: [],
            ponto6: []
        };

        // ========== EVENT LISTENERS ==========
        document.addEventListener('DOMContentLoaded', function() {
            // Data e hora padr√£o = agora
            const hoje = new Date();
            document.getElementById('dataVisita').valueAsDate = hoje;
            document.getElementById('horaVisita').value = hoje.toTimeString().slice(0,5);

            // Checkboxes de categoria - mostrar/ocultar conte√∫do
            for (let i = 1; i <= 6; i++) {
                const checkbox = document.getElementById(`ponto${i}`);
                const content = document.getElementById(`content-ponto${i}`);

                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        content.style.display = 'block';
                    } else {
                        content.style.display = 'none';
                    }
                });

                // Upload de fotos por categoria
                const uploadArea = document.querySelector(`[data-categoria="ponto${i}"]`);
                const fileInput = document.getElementById(`foto-ponto${i}`);

                uploadArea.addEventListener('click', () => fileInput.click());

                fileInput.addEventListener('change', (e) => {
                    handleFilesCategoria(e.target.files, `ponto${i}`);
                });
            }

            // Upload de fotos gerais (mantido)
            const fileUploadArea = document.getElementById('fileUploadArea');
            const fotosInput = document.getElementById('fotosInput');

            fileUploadArea.addEventListener('click', () => fotosInput.click());

            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.style.background = '#d5d9ff';
            });

            fileUploadArea.addEventListener('dragleave', () => {
                fileUploadArea.style.background = '#f8f9ff';
            });

            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.style.background = '#f8f9ff';
                handleFiles(e.dataTransfer.files);
            });

            fotosInput.addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });

            // Status selector styling
            document.querySelectorAll('.status-option').forEach(option => {
                option.addEventListener('click', function() {
                    const radio = this.querySelector('input[type="radio"]');
                    radio.checked = true;
                });
            });

            // Submit do formul√°rio
            document.getElementById('formVisita').addEventListener('submit', handleSubmit);
        });

        // ========== FUN√á√ïES DE UPLOAD DE FOTOS ==========
        // Upload de fotos por categoria
        function handleFilesCategoria(files, categoria) {
            Array.from(files).forEach(file => {
                if (!file.type.startsWith('image/')) {
                    showAlert(`${file.name} n√£o √© uma imagem v√°lida`, 'error');
                    return;
                }

                if (file.size > CONFIG.maxTamanhoFoto) {
                    showAlert(`${file.name} excede o tamanho m√°ximo de 5MB`, 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    const foto = {
                        nome: file.name,
                        base64: e.target.result.split(',')[1],
                        preview: e.target.result
                    };
                    fotosPorCategoria[categoria].push(foto);
                    renderFotoCategoria(categoria);
                };
                reader.readAsDataURL(file);
            });
        }

        function renderFotoCategoria(categoria) {
            const container = document.getElementById(`preview-${categoria}`);
            container.innerHTML = '';

            fotosPorCategoria[categoria].forEach((foto, index) => {
                const div = document.createElement('div');
                div.className = 'foto-item';
                div.innerHTML = `
                    <button type="button" class="remove-btn" onclick="removeFotoCategoria('${categoria}', ${index})">&times;</button>
                    <img src="${foto.preview}" alt="${foto.nome}">
                `;
                container.appendChild(div);
            });
        }

        function removeFotoCategoria(categoria, index) {
            fotosPorCategoria[categoria].splice(index, 1);
            renderFotoCategoria(categoria);
        }

        // Upload de fotos gerais (mantido)
        function handleFiles(files) {
            if (fotosArray.length + files.length > CONFIG.maxFotos) {
                showAlert(`M√°ximo de ${CONFIG.maxFotos} fotos permitidas`, 'error');
                return;
            }

            Array.from(files).forEach(file => {
                if (!file.type.startsWith('image/')) {
                    showAlert(`${file.name} n√£o √© uma imagem v√°lida`, 'error');
                    return;
                }

                if (file.size > CONFIG.maxTamanhoFoto) {
                    showAlert(`${file.name} excede o tamanho m√°ximo de 5MB`, 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    const foto = {
                        nome: file.name,
                        base64: e.target.result.split(',')[1],
                        comentario: '',
                        preview: e.target.result
                    };
                    fotosArray.push(foto);
                    renderFotoPreview();
                };
                reader.readAsDataURL(file);
            });
        }

        function renderFotoPreview() {
            const container = document.getElementById('fotoPreviewContainer');
            container.innerHTML = '';

            fotosArray.forEach((foto, index) => {
                const div = document.createElement('div');
                div.className = 'foto-preview-item';
                div.innerHTML = `
                    <button type="button" class="remove-foto" onclick="removeFoto(${index})">&times;</button>
                    <img src="${foto.preview}" alt="${foto.nome}">
                    <div class="foto-info">
                        <input type="text" placeholder="Coment√°rio da foto (opcional)" 
                               value="${foto.comentario}" 
                               onchange="updateComentario(${index}, this.value)">
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function removeFoto(index) {
            fotosArray.splice(index, 1);
            renderFotoPreview();
        }

        function updateComentario(index, valor) {
            fotosArray[index].comentario = valor;
        }

        // ========== SUBMIT DO FORMUL√ÅRIO ==========
        async function handleSubmit(e) {
            e.preventDefault();

            // Valida√ß√µes
            if (!validarFormulario()) {
                return;
            }

            // Desabilitar bot√£o
            const btnSubmit = document.getElementById('btnSubmit');
            btnSubmit.disabled = true;
            document.getElementById('loadingDiv').classList.add('active');

            try {
                // Montar JSON
                const dados = montarJSON();

                // Enviar para webhook
                const response = await fetch(CONFIG.webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(dados)
                });

                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }

                const resultado = await response.json();

                // Sucesso!
                showAlert('‚úÖ Relat√≥rio enviado com sucesso! Voc√™ receber√° um e-mail em breve.', 'success');

                // Limpar formul√°rio
                setTimeout(() => {
                    document.getElementById('formVisita').reset();
                    fotosArray = [];
                    renderFotoPreview();

                    // Limpar fotos por categoria
                    for (let i = 1; i <= 6; i++) {
                        fotosPorCategoria[`ponto${i}`] = [];
                        renderFotoCategoria(`ponto${i}`);
                        document.getElementById(`content-ponto${i}`).style.display = 'none';
                    }

                    window.scrollTo(0, 0);
                }, 2000);

            } catch (error) {
                console.error('Erro ao enviar:', error);
                showAlert('‚ùå Erro ao enviar relat√≥rio. Tente novamente ou contate o suporte.', 'error');
            } finally {
                btnSubmit.disabled = false;
                document.getElementById('loadingDiv').classList.remove('active');
            }
        }

        function validarFormulario() {
            const camposObrigatorios = [
                'codigoLoja', 'nomeLoja', 'cidade', 'tipoUnidade',
                'nomeVisitante', 'emailVisitante', 'area', 'tipoVisita',
                'dataVisita', 'horaVisita'
            ];

            for (let campo of camposObrigatorios) {
                const elemento = document.getElementById(campo);
                if (!elemento.value.trim()) {
                    showAlert(`Campo obrigat√≥rio n√£o preenchido: ${elemento.previousElementSibling.textContent}`, 'error');
                    elemento.focus();
                    return false;
                }
            }

            const statusGeral = document.querySelector('input[name="statusGeral"]:checked');
            if (!statusGeral) {
                showAlert('Selecione o status geral da unidade', 'error');
                return false;
            }

            return true;
        }

        function montarJSON() {
            // Pegar valores do formul√°rio
            const formData = new FormData(document.getElementById('formVisita'));

            // Pontos avaliados (checkboxes) com observa√ß√µes e fotos
            const pontosAvaliados = [];
            const categorias = {
                ponto1: 'Sistema El√©trico',
                ponto2: 'Climatiza√ß√£o',
                ponto3: 'Limpeza Geral',
                ponto4: 'Layout e Sinaliza√ß√£o',
                ponto5: 'Equipamentos TI',
                ponto6: 'Seguran√ßa'
            };

            for (let i = 1; i <= 6; i++) {
                const checkbox = document.getElementById(`ponto${i}`);
                if (checkbox && checkbox.checked) {
                    const categoria = `ponto${i}`;
                    const observacao = document.getElementById(`obs-${categoria}`).value;
                    const fotos = fotosPorCategoria[categoria].map(f => ({
                        nome: f.nome,
                        base64: f.base64
                    }));

                    pontosAvaliados.push({
                        item: categorias[categoria],
                        observacao: observacao || 'Sem observa√ß√µes.',
                        fotos: fotos
                    });
                }
            }

            // Montar objeto completo
            const dados = {
                id_resposta: `FORM-${Date.now()}`,
                timestamp: new Date().toISOString(),
                loja: {
                    codigo: formData.get('codigoLoja'),
                    nome: formData.get('nomeLoja'),
                    cidade: formData.get('cidade'),
                    tipo: formData.get('tipoUnidade'),
                    email: '' // Ser√° buscado pelo backend
                },
                visita: {
                    responsavel: formData.get('emailVisitante'),
                    nome_responsavel: formData.get('nomeVisitante'),
                    area: formData.get('area'),
                    data: formData.get('dataVisita'),
                    hora: formData.get('horaVisita'),
                    tipo_visita: formData.get('tipoVisita')
                },
                avaliacao: {
                    status_geral: formData.get('statusGeral'),
                    pontos_avaliados: pontosAvaliados,
                    observacoes: formData.get('observacoes') || 'Nenhuma observa√ß√£o adicional.'
                },
                acoes: {
                    necessarias: formData.get('acoesNecessarias') || 'Nenhuma a√ß√£o necess√°ria no momento.',
                    prazo: formData.get('prazo') || 'N/A',
                    prioridade: formData.get('prioridade')
                },
                fotos_gerais: fotosArray.map(f => ({
                    nome: f.nome,
                    base64: f.base64,
                    comentario: f.comentario
                })),
                config: {
                    incluir_pdf: true,
                    template: 'padrao_visita'
                }
            };

            return dados;
        }

        function showAlert(mensagem, tipo) {
            const alertContainer = document.getElementById('alertContainer');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${tipo} show`;
            alertDiv.textContent = mensagem;
            
            alertContainer.innerHTML = '';
            alertContainer.appendChild(alertDiv);
            
            // Scroll para o topo
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Remover ap√≥s 5 segundos
            setTimeout(() => {
                alertDiv.classList.remove('show');
            }, 5000);
        }
    </script>
</body>
</html>
